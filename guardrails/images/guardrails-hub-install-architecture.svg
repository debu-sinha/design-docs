<svg xmlns="http://www.w3.org/2000/svg" width="880" height="600" viewBox="60 0 880 600">
<defs>
  <marker id="arrow-gray" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
    <polygon points="0 0, 10 3.5, 0 7" fill="#868e96" />
  </marker>
  <marker id="arrow-red" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
    <polygon points="0 0, 10 3.5, 0 7" fill="#e03131" />
  </marker>
  <style>text { font-family: "Segoe UI", system-ui, -apple-system, sans-serif; }</style>
</defs>

<!-- Title -->
<text x="80" y="32" font-size="22" fill="#1971c2" font-weight="600">Current Hub Install Architecture</text>

<!-- Box 0: CLI Entry -->
<rect x="80" y="56" width="480" height="44" rx="8" fill="#1864ab" stroke="#f8f9fa" stroke-width="1" />
<text x="320" y="78" font-size="13" fill="#f8f9fa" text-anchor="middle" dominant-baseline="central">guardrails hub install hub://guardrails/detect_pii</text>

<!-- Arrow 0-1 -->
<path d="M 320 100 L 320 132" stroke="#868e96" fill="none" stroke-width="2" marker-end="url(#arrow-gray)" />

<!-- Box 1: get_validator_id -->
<rect x="80" y="132" width="480" height="44" rx="8" fill="#228be6" stroke="#f8f9fa" stroke-width="1" />
<text x="320" y="154" font-size="14" fill="#f8f9fa" text-anchor="middle" dominant-baseline="central">1. get_validator_id(package_uri)</text>
<text x="576" y="154" font-size="10" fill="#868e96">Parses hub:// URI</text>

<!-- Arrow 1-2 -->
<path d="M 320 176 L 320 208" stroke="#868e96" fill="none" stroke-width="2" marker-end="url(#arrow-gray)" />

<!-- Box 2: get_validator_manifest -->
<rect x="80" y="208" width="480" height="44" rx="8" fill="#228be6" stroke="#f8f9fa" stroke-width="1" />
<text x="320" y="230" font-size="14" fill="#f8f9fa" text-anchor="middle" dominant-baseline="central">2. get_validator_manifest(validator_id)</text>

<!-- Side box: get_site_packages_location (RED - breaks with uv) -->
<rect x="584" y="208" width="280" height="44" rx="8" fill="#e03131" stroke="#f8f9fa" stroke-width="1" />
<text x="724" y="230" font-size="12" fill="#f8f9fa" text-anchor="middle" dominant-baseline="central">get_site_packages_location()</text>
<path d="M 560 230 L 584 230" stroke="#e03131" fill="none" stroke-width="2" marker-end="url(#arrow-red)" />
<text x="584" y="268" font-size="10" fill="#868e96">importlib.import_module('pip')</text>

<!-- Arrow 2-3 -->
<path d="M 320 252 L 320 284" stroke="#868e96" fill="none" stroke-width="2" marker-end="url(#arrow-gray)" />

<!-- Box 3: install_hub_module (RED - breaks with uv) -->
<rect x="80" y="284" width="480" height="44" rx="8" fill="#e03131" stroke="#f8f9fa" stroke-width="1" />
<text x="320" y="306" font-size="14" fill="#f8f9fa" text-anchor="middle" dominant-baseline="central">3. install_hub_module(validator_id)</text>
<text x="576" y="298" font-size="10" fill="#868e96">Subprocess: sys.executable -m pip</text>
<text x="576" y="312" font-size="10" fill="#868e96">--index-url=pypi.guardrailsai.com</text>

<!-- Arrow 3-4 -->
<path d="M 320 328 L 320 360" stroke="#868e96" fill="none" stroke-width="2" marker-end="url(#arrow-gray)" />

<!-- Box 4: run_post_install -->
<rect x="80" y="360" width="480" height="44" rx="8" fill="#3b5bdb" stroke="#f8f9fa" stroke-width="1" />
<text x="320" y="382" font-size="14" fill="#f8f9fa" text-anchor="middle" dominant-baseline="central">4. run_post_install(manifest, site_packages)</text>
<text x="576" y="382" font-size="10" fill="#868e96">Subprocess: python post_install.py</text>

<!-- Arrow 4-5 -->
<path d="M 320 404 L 320 436" stroke="#868e96" fill="none" stroke-width="2" marker-end="url(#arrow-gray)" />

<!-- Box 5: add_to_hub_inits (RED - breaks with uv) -->
<rect x="80" y="436" width="480" height="44" rx="8" fill="#e03131" stroke="#f8f9fa" stroke-width="1" />
<text x="320" y="458" font-size="14" fill="#f8f9fa" text-anchor="middle" dominant-baseline="central">5. add_to_hub_inits(manifest, site_packages)</text>
<text x="576" y="450" font-size="10" fill="#868e96">Mutates hub/__init__.py</text>
<text x="576" y="464" font-size="10" fill="#868e96">in site-packages directly</text>

<!-- Arrow 5-6 -->
<path d="M 320 480 L 320 512" stroke="#868e96" fill="none" stroke-width="2" marker-end="url(#arrow-gray)" />

<!-- Box 6: reload_module (Green - success) -->
<rect x="80" y="512" width="480" height="44" rx="8" fill="#40c057" stroke="#f8f9fa" stroke-width="1" />
<text x="320" y="534" font-size="14" fill="#f8f9fa" text-anchor="middle" dominant-baseline="central">6. reload_module() -&gt; Validator ready</text>

<!-- Legend -->
<rect x="584" y="512" width="168" height="56" rx="8" fill="#f8f9fa" stroke="#868e96" stroke-width="1" />
<text x="596" y="530" font-size="10" fill="#e03131">Red = breaks with uv</text>
<text x="596" y="544" font-size="10" fill="#228be6">Blue = unchanged</text>
<text x="596" y="558" font-size="10" fill="#3b5bdb">Indigo = post-install step</text>

<!-- Source -->
<text x="80" y="588" font-size="10" fill="#868e96">Source: guardrails/hub/install.py, validator_package_service.py, cli/hub/utils.py</text>
</svg>
