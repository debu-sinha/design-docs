<svg xmlns="http://www.w3.org/2000/svg" width="940" height="608" viewBox="56 0 940 608">
<defs>
  <marker id="arrow-gray" markerWidth="12" markerHeight="9" refX="11" refY="4.5" orient="auto">
    <polygon points="0 0, 12 4.5, 0 9" fill="#868e96" />
  </marker>
  <marker id="arrow-red" markerWidth="12" markerHeight="9" refX="11" refY="4.5" orient="auto">
    <polygon points="0 0, 12 4.5, 0 9" fill="#e03131" />
  </marker>
  <style>text { font-family: "Segoe UI", system-ui, -apple-system, sans-serif; }</style>
</defs>

<!-- Title -->
<text x="80" y="32" font-size="22" fill="#1971c2" font-weight="600">Current Hub Install Architecture</text>

<!-- Box 0: CLI Entry -->
<rect x="80" y="56" width="480" height="44" rx="8" fill="#1864ab" stroke="#1864ab" stroke-width="1" />
<text x="320" y="78" font-size="13" fill="#f8f9fa" text-anchor="middle" dominant-baseline="central">guardrails hub install hub://guardrails/detect_pii</text>

<!-- Arrow 0-1 -->
<path d="M 320 100 L 320 132" stroke="#868e96" fill="none" stroke-width="2" marker-end="url(#arrow-gray)" />

<!-- Box 1: get_validator_id -->
<rect x="80" y="132" width="480" height="44" rx="8" fill="#228be6" stroke="#228be6" stroke-width="1" />
<text x="320" y="154" font-size="14" fill="#f8f9fa" text-anchor="middle" dominant-baseline="central">1. get_validator_id(package_uri)</text>
<text x="576" y="154" font-size="11" fill="#868e96">Parses hub:// URI</text>

<!-- Arrow 1-2 -->
<path d="M 320 176 L 320 208" stroke="#868e96" fill="none" stroke-width="2" marker-end="url(#arrow-gray)" />

<!-- Box 2: get_validator_manifest -->
<rect x="80" y="208" width="480" height="44" rx="8" fill="#228be6" stroke="#228be6" stroke-width="1" />
<text x="320" y="230" font-size="14" fill="#f8f9fa" text-anchor="middle" dominant-baseline="central">2. get_validator_manifest(validator_id)</text>

<!-- Horizontal arrow to side box (80px - clearly visible) -->
<path d="M 560 230 L 640 230" stroke="#e03131" fill="none" stroke-width="2" marker-end="url(#arrow-red)" />

<!-- Side box: get_site_packages_location (RED - breaks with uv) -->
<rect x="640" y="208" width="272" height="44" rx="8" fill="#e03131" stroke="#e03131" stroke-width="1" />
<text x="776" y="230" font-size="12" fill="#f8f9fa" text-anchor="middle" dominant-baseline="central">get_site_packages_location()</text>
<text x="640" y="270" font-size="11" fill="#868e96">importlib.import_module('pip')</text>

<!-- Arrow 2-3 -->
<path d="M 320 252 L 320 284" stroke="#868e96" fill="none" stroke-width="2" marker-end="url(#arrow-gray)" />

<!-- Box 3: install_hub_module (RED - breaks with uv) -->
<rect x="80" y="284" width="480" height="44" rx="8" fill="#e03131" stroke="#e03131" stroke-width="1" />
<text x="320" y="306" font-size="14" fill="#f8f9fa" text-anchor="middle" dominant-baseline="central">3. install_hub_module(validator_id)</text>
<text x="576" y="298" font-size="11" fill="#868e96">Subprocess: sys.executable -m pip</text>
<text x="576" y="314" font-size="11" fill="#868e96">--index-url=pypi.guardrailsai.com</text>

<!-- Arrow 3-4 -->
<path d="M 320 328 L 320 360" stroke="#868e96" fill="none" stroke-width="2" marker-end="url(#arrow-gray)" />

<!-- Box 4: run_post_install -->
<rect x="80" y="360" width="480" height="44" rx="8" fill="#3b5bdb" stroke="#3b5bdb" stroke-width="1" />
<text x="320" y="382" font-size="14" fill="#f8f9fa" text-anchor="middle" dominant-baseline="central">4. run_post_install(manifest, site_packages)</text>
<text x="576" y="382" font-size="11" fill="#868e96">Subprocess: python post_install.py</text>

<!-- Arrow 4-5 -->
<path d="M 320 404 L 320 436" stroke="#868e96" fill="none" stroke-width="2" marker-end="url(#arrow-gray)" />

<!-- Box 5: add_to_hub_inits (RED - breaks with uv) -->
<rect x="80" y="436" width="480" height="44" rx="8" fill="#e03131" stroke="#e03131" stroke-width="1" />
<text x="320" y="458" font-size="14" fill="#f8f9fa" text-anchor="middle" dominant-baseline="central">5. add_to_hub_inits(manifest, site_packages)</text>
<text x="576" y="450" font-size="11" fill="#868e96">Mutates hub/__init__.py</text>
<text x="576" y="466" font-size="11" fill="#868e96">in site-packages directly</text>

<!-- Arrow 5-6 -->
<path d="M 320 480 L 320 512" stroke="#868e96" fill="none" stroke-width="2" marker-end="url(#arrow-gray)" />

<!-- Box 6: reload_module (Green - success) -->
<rect x="80" y="512" width="480" height="44" rx="8" fill="#40c057" stroke="#40c057" stroke-width="1" />
<text x="320" y="534" font-size="14" fill="#f8f9fa" text-anchor="middle" dominant-baseline="central">6. reload_module() -&gt; Validator ready</text>

<!-- Legend -->
<rect x="640" y="512" width="200" height="60" rx="8" fill="#f8f9fa" stroke="#dee2e6" stroke-width="1" />
<rect x="652" y="524" width="12" height="12" rx="2" fill="#e03131" />
<text x="670" y="535" font-size="11" fill="#495057">breaks with uv</text>
<rect x="652" y="542" width="12" height="12" rx="2" fill="#228be6" />
<text x="670" y="553" font-size="11" fill="#495057">unchanged</text>
<rect x="652" y="560" width="12" height="12" rx="2" fill="#3b5bdb" />
<text x="670" y="571" font-size="11" fill="#495057">post-install step</text>

<!-- Source -->
<text x="80" y="596" font-size="10" fill="#868e96">Source: guardrails/hub/install.py, validator_package_service.py, cli/hub/utils.py</text>
</svg>
